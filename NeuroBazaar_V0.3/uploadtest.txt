import os
import django
from datetime import datetime
from django.conf import settings

# Manually configure Django settings
settings.configure(DEBUG=True)
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'DSH.settings') 
django.setup()

# Now that Django is set up, import your models
from home.models import DatasetDescription, User

def simulate_file_upload(uploaded_file, description, visibility, user):
    # Simulate file upload and store upload time
    start_time = datetime.now()

    # Simulate saving the file path to the database
    new_dataset_description = DatasetDescription(
        user=user,
        dataset_name='Uploaded File',
        description=description,
        file_path=15,
        dataset_file=uploaded_file  
    )
    new_dataset_description.save()

    # Measure the end time of the upload process
    end_time = datetime.now()

    # Calculate the upload time
    upload_time = end_time - start_time
    print(f"Upload Time: {upload_time.total_seconds()} seconds")

    return upload_time

file_path = r'C:\Users\Rushikesh\Downloads\Datasets\187mb.csv' 
description = 'Test upload'
visibility = 'public'
user = User.objects.get(username='admin')

# Open the file and pass it to the upload function
with open(file_path, 'rb') as uploaded_file:
    response = simulate_file_upload(uploaded_file, description, visibility, user)
