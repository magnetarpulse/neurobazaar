{% extends 'base.html' %}

{% block title %}Datastore{% endblock title %}
{% block nav4 %} d-none {% endblock nav4 %}
{% block body %}

<!-- Masthead-->
<header class="masthead" style="background">
    <div class="container">
        <div class="masthead-heading">Set up your datastore</div>
    </div> 
</header>

<!-- Configuration Section -->
<section class="page-section bg-light">
    <div class="container">
        <div class="text-center">
            <h2 class="section-heading text-uppercase">DataStore Configuration</h2>
        </div>
        <br> <br>
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="section-heading text-uppercase mb-0">DataStores</h3>
            <button id="addDatastoreButton" class="btn btn-primary">Add Datastore</button>
        </div> 
        
        <div id="datastoreFormPopup" class="hidden">
            <form id="databaseForm" method="post">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="database">Add Datastore :</label>
                    <select class="form-control" id="database" name="database" onchange="showForm()">
                        <option value="default">Select a Datastore</option>
                        <option value="filesystem">FileSystem</option>
                        <option value="mongodb">MongoDB</option>
                    </select>
                </div>

                <!-- FileSystem Configuration -->
                <div id="filesystemForm" class="hidden">
                    <h4>FileSystem Configuration</h4>
                    <div class="mb-3">
                        <label for="datastore_name">Datastore Name:</label>
                        <input type="text" class="form-control" id="datastore_name" name="datastore_name">
                        <label for="destination_path">Destination Path:</label>
                        <input type="text" class="form-control" id="destination_path" name="destination_path">
                    </div>
                    <button type="submit" class="btn btn-primary" name="add_datastore">Add FileSystem</button>
                </div>

                <!-- MongoDB Configuration -->
                <div id="mongodbForm" class="hidden">
                    <h4>MongoDB Configuration</h4>
                    <div class="mb-3">
                        <label for="client_mongo">Client:</label>
                        <input type="text" class="form-control" id="client_mongo" name="client_mongo">
                    </div>
                    <div class="mb-3">
                        <label for="db_mongo">DB:</label>
                        <input type="text" class="form-control" id="db_mongo" name="db_mongo">
                    </div>
                    <div class="mb-3">
                        <label for="table_mongo">Table:</label>
                        <input type="text" class="form-control" id="table_mongo" name="table_mongo">
                    </div>
                    <button type="submit" class="btn btn-primary" name="add_datastore">Add MongoDB</button>
                </div>
            </form>
        </div>

        <!-- Existing DataStores -->
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Datastore ID</th>
                    <th>Datastore Name</th>
                    <th>Datastore Type</th>
                    <th>Date Created</th>
                    <th>Remove Datastore</th>
                </tr>
            </thead>
            <tbody>
                {% for datastore in datastores %}
                <tr>
                    <td>{{ datastore.UUID }}</td>
                    <td>{{ datastore.Name }}</td>
                    <td>{{ datastore.Type }}</td>
                    <td>{{ datastore.Created }}</td>
                    <td>
                        <!-- Add a form for removing a DataStore -->
                        <form method="post" action="" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="datastore_id" value="{{ datastore.UUID }}">
                            <button type="submit" class="btn btn-danger" id="remove_datastore" name="remove_datastore">Remove</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>

<!-- Footer-->
<footer class="footer py-4">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-4 text-lg-start">Copyright &copy; Neurobazaar 2024</div>
            <div class="col-lg-4 my-3 my-lg-0">
                <a class="btn btn-dark btn-social mx-2" href="#!" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                <a class="btn btn-dark btn-social mx-2" href="#!" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                <a class="btn btn-dark btn-social mx-2" href="#!" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
            </div>
            <div class="col-lg-4 text-lg-end">
                <a class="link-dark text-decoration-none me-3" href="#!">Privacy Policy</a>
                <a class="link-dark text-decoration-none" href="#!">Terms of Use</a>
            </div>
        </div>
    </div>
</footer>

<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f9;
        color: #333;
        margin: 0;
    }

    h2 {
        color: #0056b3;
    }

    .form-control {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    button {
        background-color: #0056b3;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }

    button:hover {
        background-color: #004494;
    }

    .hidden {
        display: none;
    }

    .popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
    }

    .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 999;
    }

    .d-flex {
        display: flex;
    }

    .justify-content-between {
        justify-content: space-between;
    }

    .align-items-center {
        align-items: center;
    }

    .table {
        width: 100%;
        margin-bottom: 1rem;
        color: #212529;
        border-collapse: collapse;
    }

    .table th, .table td {
        padding: 0.75rem;
        vertical-align: top;
        border-top: 1px solid #dee2e6;
    }

    .table thead th {
        vertical-align: bottom;
        border-bottom: 2px solid #dee2e6;
    }

    .table tbody + tbody {
        border-top: 2px solid #dee2e6;
    }

    .table-striped tbody tr:nth-of-type(odd) {
        background-color: rgba(0, 0, 0, 0.05);
    }
</style>

<script>
    document.getElementById('addDatastoreButton').addEventListener('click', function() {
        document.getElementById('datastoreFormPopup').classList.remove('hidden');
        document.getElementById('datastoreFormPopup').classList.add('popup');
        const overlay = document.createElement('div');
        overlay.classList.add('popup-overlay');
        overlay.id = 'popupOverlay';
        document.body.appendChild(overlay);

        overlay.addEventListener('click', function() {
            document.getElementById('datastoreFormPopup').classList.add('hidden');
            document.getElementById('datastoreFormPopup').classList.remove('popup');
            document.body.removeChild(overlay);
        });
    });

    function showForm() {
        var database = document.getElementById('database').value;
        document.getElementById('filesystemForm').classList.add('hidden');
        document.getElementById('mongodbForm').classList.add('hidden');
        
        if (database === 'filesystem') {
            document.getElementById('filesystemForm').classList.remove('hidden');
        } else if (database === 'mongodb') {
            document.getElementById('mongodbForm').classList.remove('hidden');
        }
    }
</script>

{% endblock body %}
